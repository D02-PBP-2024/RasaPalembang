{% extends 'base.html' %}
{% load widget_tweaks %}

{% block meta %}
<title>RasaPalembang | Tambah Makanan</title>
<style>
    /* Animasi untuk progress bar */
    .progress-bar {
        width: 0;
        height: 4px;
        background-color: #4f9da6;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 50;
        animation: load 3s ease-out forwards;
    }

    @keyframes load {
        0% {
            width: 0;
        }

        100% {
            width: 100%;
        }
    }

    /* Styling untuk layout form */
    .form-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;  /* Menambah jarak antar kolom */
    }

    .full-span {
        grid-column: span 2;
    }

    /* Styling untuk label dan input */
    label {
        font-size: 1rem;
        color: #4a4a4a;
        padding-left: 0.5rem;
        font-weight: 600;
    }

    input, select, textarea {
        width: 100%;
        margin-top: 0.5rem;
        background-color: #f5f5f5;
        border-radius: 0.5rem;  /* Membuat input lebih rounded */
        padding: 0.875rem;
        border: 1px solid #d1d5db;
        font-size: 1rem;  /* Memperbesar font */
    }

    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #4f9da6;
        box-shadow: 0 0 0 2px rgba(79, 157, 166, 0.3);
    }

    /* Styling untuk button upload gambar */
    .upload-btn {
        display: inline-block;
        width: 100%;
        background-color: #f5f5f5;
        border-radius: 0.5rem;
        padding: 0.875rem;
        text-align: center;
        color: #4f9da6;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .upload-btn:hover {
        background-color: #e2e8f0;
    }

    /* Chips design */
    .chips-wrapper {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: start;  /* Justifikasi ke kiri */
    }

    .chip {
        padding: 10px 15px;
        background-color: #4f9da6;
        color: white;
        border-radius: 20px;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .chip:hover {
        background-color: #3b747a;
    }

    .chip.active {
        background-color: #ff5757;
    }

    .hidden-input {
        display: none;
    }
</style>
{% endblock meta %}

{% block content %}
<main class="px-5 md:px-10 lg:px-16 xl:px-24 py-5 md:py-10 w-full mx-auto">
    <h2 class="mt-8 text-xl font-semibold">Tambah Makanan Baru</h2>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="grid grid-cols-2 sm:gap-x-4 w-full">
            <div class="mt-4 col-span-2 sm:col-span-1">
                <label class="text-sm pl-3" for="nama">Nama Makanan</label>
                {{ form.nama|add_class:"w-full mt-2 bg-gray-100 rounded px-4 py-3.5 placeholder:text-[#808080] focus-visible:outline-[#4f9da6]" }}
            </div>
            <div class="mt-4 col-span-2 sm:col-span-1">
                <label class="text-sm pl-3" for="harga">Harga</label>
                {{ form.harga|add_class:"w-full mt-2 bg-gray-100 rounded px-4 py-3.5 placeholder:text-[#808080] focus-visible:outline-[#4f9da6]" }}
            </div>
        </div>
        <div class="mt-4">
            <label class="text-sm pl-3" for="deskripsi">Deskripsi</label>
            {{ form.deskripsi|add_class:"w-full resize-none h-36 mt-2 bg-gray-100 rounded px-4 py-3.5 placeholder:text-[#808080] focus-visible:outline-[#4f9da6]" }}
        </div>
        <div class="grid grid-cols-2 sm:gap-x-4 w-full">
            <div class="mt-4 col-span-2 sm:col-span-1">
                <label class="text-sm pl-3" for="kalori">Kalori</label>
                {{ form.kalori|add_class:"w-full mt-2 bg-gray-100 rounded px-4 py-3.5 placeholder:text-[#808080] focus-visible:outline-[#4f9da6]" }}
            </div>
            <div class="mt-4 col-span-2 sm:col-span-1">
                <label class="text-sm pl-3" for="gambar">Gambar</label>
                <div class="mt-2 flex items-center">
                    <label for="id_gambar"
                        class="w-full overflow-hidden relative cursor-pointer bg-gray-100 rounded font-medium text-[#4f9da6] hover:text-[#3b747a] px-4 py-3.5 text-center focus-visible:outline-[#4f9da6]">
                        <span id="gambar-file">Upload gambar</span>
                        {{ form.gambar|add_class:"sr-only" }}
                    </label>
                </div>
            </div>
            <div class="mt-4 col-span-2 sm:col-span-1">
                <label class="text-sm pl-3" for="restoran">Restoran</label>
                {{ form.restoran|add_class:"w-full mt-2 bg-gray-100 rounded px-4 py-3.5 placeholder:text-[#808080] focus-visible:outline-[#4f9da6]" }}
            </div>
            <div class="mt-4 col-span-2 sm:col-span-1">
                <label class="text-sm pl-3">Kategori</label>
                <div class="relative">
                    <div class="relative">
                        <button id="dropdownButton" class="w-full mt-2 bg-gray-100 rounded px-4 py-3.5 text-left flex justify-between items-center">
                            <span id="dropdownPlaceholder">Pilih Kategori</span>
                            <i class="fa fa-caret-down"></i>
                        </button>

                        <ul id="kategoriDropdown" class="absolute z-10 hidden w-full bg-white rounded-lg shadow-lg mt-2">
                            {% for kategori in form.kategori.field.queryset %}
                            <li>
                                <button class="kategori-option block w-full px-4 py-2 text-left text-gray-700 hover:bg-gray-200"
                                    data-id="{{ kategori.id }}">{{ kategori.nama }}</button>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="chips-wrapper mt-4" id="chipsContainer"></div>
                </div>
            </div>
        </div>
        <button
            class="mt-8 shadow hover:shadow-lg bg-[#4f9da6] hover:bg-[#3b747a] transition focus:shadow-outline focus:bg-[#3b747a] focus:outline-none text-white font-semibold py-2 px-4 rounded"
            type="submit">
            Simpan
        </button>
    </form>
</main>
<script>
    var gambarUpload = document.getElementById('id_gambar');
    var gambarFile = document.getElementById('gambar-file');
    gambarUpload.addEventListener('change', function () {
        gambarFile.innerText = gambarUpload.files[0].name;
    });

    const dropdownButton = document.getElementById('dropdownButton');
    const dropdownList = document.getElementById('kategoriDropdown');
    const chipsContainer = document.getElementById('chipsContainer');
    const hiddenInputsContainer = document.getElementById('hiddenInputsContainer');
    const selectedKategori = new Set();

    // Toggle dropdown visibility on click
    dropdownButton.addEventListener('click', function () {
        dropdownList.classList.toggle('hidden');
    });

    // Hide dropdown if clicked outside
    document.addEventListener('click', function (e) {
        if (!dropdownButton.contains(e.target) && !dropdownList.contains(e.target)) {
            dropdownList.classList.add('hidden');
        }
    });

    // Fungsi untuk membuat chip
    function createChip(id, nama) {
        const chip = document.createElement('span');
        chip.classList.add('chip');
        chip.textContent = nama;

        const closeButton = document.createElement('button');
        closeButton.classList.add('chip-close');
        closeButton.innerHTML = '&times;';
        closeButton.onclick = () => {
            // Hapus chip ketika tombol "x" diklik
            chip.remove();
            selectedKategori.delete(id);
            // Hapus hidden input terkait
            document.querySelector(`#hiddenKategoriInput-${id}`).remove();
        };

        chip.appendChild(closeButton);
        chipsContainer.appendChild(chip);
    }

    // Event listener ketika memilih kategori dari dropdown
    document.querySelectorAll('.kategori-option').forEach(option => {
        option.addEventListener('click', function () {
            const id = this.getAttribute('data-id');
            const nama = this.textContent;

            if (!selectedKategori.has(id)) {
                selectedKategori.add(id);
                createChip(id, nama);

                // Tambahkan hidden input untuk kategori terpilih
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'kategori';
                hiddenInput.value = id;
                hiddenInput.id = `hiddenKategoriInput-${id}`;
                hiddenInputsContainer.appendChild(hiddenInput);
            }

            dropdownList.classList.add('hidden');  // Sembunyikan dropdown setelah memilih
        });
    });
</script>
{% endblock content %}